---
title: 'Real Economy Tracker'
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
##R Preamble
library(MacrobondAPI)
library(tidyverse)
library(zoo)
library(xts)
library(tsbox)
library(ggplot2)
#library(plotly)
library(htmlwidgets)
library(htmltools)
library(dygraphs)
#library(gridExtra)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
##Electricity

electricity <- c("entso_loa_de_11_q1", "entso_loa_fr_11", "entso_loa_it_11", "entso_loa_es_11")
request_elec <-MakeXtsFromUnifiedResponse(FetchUnifiedTimeSeriesDefault(electricity))
week_elec <-  rollapply(request_elec, 7, mean)
week_el_index <- as.xts(apply(week_elec,2, function(x)  x*100/x["2020-02-01"]))

colnames(week_el_index) <- c("Deutschland", "Frankreich", "Italien", "Spanien")

##China
electricity_cn <- c("cnprod0401")
request_elec_cn <-MakeXtsFromUnifiedResponse(FetchUnifiedTimeSeriesDefault(electricity_cn))
week_elec_cn <-  request_elec_cn
week_el_index_cn <- as.xts(apply(week_elec_cn,2, function(x)  x*100/x["2020-02-01"]))

colnames(week_el_index_cn) <- c("China")

## Merge US DATA
library(eia)
mykey <- "b6e4a42a8e85f78a8e1e4fcfd1d7f6dd"
eia_set_key(mykey)
id <- "EBA.US48-ALL.D.H"
d <- eia_series(id, n = 10000)

us_elec <- data.frame(d$data)
us_elec <- data.frame(us_elec$date,us_elec$value)
us_elec_ts <- ts_xts(us_elec)
us_day <- apply.daily(us_elec_ts,mean,1)
index(us_day)<- as.Date(unlist(lapply(strsplit(as.character(index(us_day))," "), function(x) x[1])))

us_7day <-  rollapply(us_day, 7, mean)
us_7day_index <- as.xts(apply(us_7day,2, function(x)  x*100/x["2020-02-01"]))
colnames(us_7day_index) <- c("USA")

week_all_index <- merge(week_el_index, us_7day_index, week_el_index_cn)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
##Dynamic Graph
dygraph(week_all_index["201811/"], main = "Stromverbrauch (01.02.2020 = 100)", width = 800)%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>%
  dyOptions(colors = c("black","maroon", "gray", "navy", "blue", "red"))%>%
  dyCSS("legend.css")%>%
  dyLegend(labelsSeparateLines = TRUE)%>%
  dySeries(na.omit("China"), stepPlot = TRUE, fillGraph = TRUE, color = "red")%>%
  dyRangeSelector()%>%
  dyUnzoom()
```
*Quelle: Flossbach von Storch Research Institute, \n ENTSO-E, EIA, China NEA.*

```{r echo=FALSE, message= FALSE, warning=FALSE}
##China
china<- c("cnprod0401", "cnprod0185", "jodicngsdem_kbd")
request_cn <-MakeXtsFromUnifiedResponse(FetchUnifiedTimeSeriesDefault(china))
index_cn <- as.xts(apply(request_cn,2, function(x)  x*100/x["2019-11-01"]))

colnames(index_cn) <- c("Electricity Consumption", "Vehicle Production", "Gasoline (Motor & Aviation)")

dygraph(index_cn["201701/"], main = "China (November 2019 = 100)", width = 800)%>%
dyAxis("x", drawGrid = FALSE)%>% 
dyHighlight(highlightSeriesOpts = list(strokeWidth = 2))%>%
dyOptions(colors = c("black","maroon", "gray"))%>%
dyCSS("cn_legend.css")%>%
  dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
dyRangeSelector()%>%
  dyUnzoom()
```
*Quelle: Flossbach von Storch Research Institute, \n China Nationa Energy Asociation, Association of Automobile Manufacturers, Joint Organisations Data Initiative.*

```{r echo=FALSE, message= FALSE, warning=FALSE}
##Citiy Moblity Index
mobility<- c("citmap0014", "citmap0024", "citmap0025", "citmap0027", "citmap0010", "citmap0020", "citmap0016", "citmap0013")

request_mobility <-MakeXtsFromUnifiedResponse(FetchUnifiedTimeSeriesDefault(mobility))
colnames(request_mobility) <- c("Los Angeles", "NYC", "Paris", "Rhine-Ruhr", "Hong-Kong", "Milan", "Madrid", "London")

dygraph(request_mobility["202001/"], main = "Citymapper Mobility Index", width = 800)%>%
dyAxis("x", drawGrid = FALSE)%>% 
dyHighlight(highlightSeriesOpts = list(strokeWidth = 2))%>%
dyOptions(colors = c("black","maroon", "gray", "red", "blue", "orange", "green", "navy"))%>%
dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
  dyCSS("legend.css")%>%
  dyRangeSelector()%>%
  dyUnzoom()
```
*Quelle: Flossbach von Storch Research Institute, \n [Citymapper Mobility Index](https://citymapper.com/cmi/about)*


```{r echo=FALSE, message=FALSE, warning=FALSE}
trucks <- c("detran0225")
request_trucks <-MakeXtsFromUnifiedResponse(FetchUnifiedTimeSeriesDefault(trucks))
colnames(request_trucks) <- c("Index")
trucks_ma <-  rollapply(request_trucks, 7, mean)
trucks_ma_index <- as.xts(apply(trucks_ma,2, function(x)  x*100/x["2020-02-01"]))

dygraph(trucks_ma["202002/"], main = "Lkw-Maut-Fahrleistungsindex: Deutschland", width = 800)%>%
dyAxis("x", drawGrid = FALSE)%>% 
dyHighlight(highlightSeriesOpts = list(strokeWidth = 2))%>%
dyOptions(colors = c("black","maroon", "gray", "navy", "orange"))%>%
dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
  dyCSS("legend.css")%>%
dyRangeSelector()%>%
  dyUnzoom()
```
*Quelle: Flossbach von Storch Research Institute, \n Statistisches Bundesamt.*

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(gtrendsR)
keywords=c("hotel")
#set the geographic area: DE = Germany
country=c("DE")
#set the time window
time <- paste("2019-12-01 ",Sys.Date(), sep = "")
#set channels 
channel="web"

hotels <- gtrends(keywords, geo = c("DE", "FR", "IT", "ES", "US"), time, onlyInterest=TRUE)
hh <- hotels$interest_over_time
hh <- data.frame(hh$date,hh$geo,hh$hits)
colnames(hh)<-c("time","country","value")
hotels_ts <- ts_xts(hh)

hotels_week <-  rollapply(hotels_ts, 7, mean)

##Airbnb
keywords=c("airbnb")
#set the geographic area: DE = Germany
country=c("DE", "FR", "IT", "ES", "US")
#set the time window
##time="2019-12-01 2020-05-12"
time <- paste("2019-12-01 ",Sys.Date(), sep = "")

#set channels 
channel="web"

airbnb <- gtrends(keywords, geo = country, time, onlyInterest=TRUE)
hh <- airbnb$interest_over_time
hh <- data.frame(hh$date,hh$geo,hh$hits)
colnames(hh)<-c("time","country","value")
airbnb_ts <- ts_xts(hh)

airbnb_week <-  rollapply(hotels_ts, 7, mean)

dygraph(hotels_week["20200201/"], main = "Google Trends: 'Hotel'", width = 800)%>%
dyAxis("x", drawGrid = FALSE)%>%
dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>%
dyOptions(colors = c("black","maroon", "gray", "navy", "orange"))%>%
dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
  dyCSS("legend.css")%>%
  dyRangeSelector()%>%
  dyUnzoom()

dygraph(airbnb_week["20200201/"], main = "Google Trends: 'Airbnb'", width = 800)%>%
dyAxis("x", drawGrid = FALSE)%>%
dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>%
dyOptions(colors = c("black","maroon", "gray", "navy", "orange"))%>%
dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
  dyCSS("legend.css")%>%
  dyRangeSelector()%>%
  dyUnzoom()

```
*Quelle: Flossbach von Storch Research Institute, \n Google Trends*

```{r echo=FALSE, results= "hide", message=FALSE, warning=FALSE}
keywords=c("flight","booking","reservation","restaurant")
#set the time window
us <- sapply(keywords, function(x) gtrends(x, geo = "DE", time, onlyInterest=TRUE))
us_l<- data.frame(us$flight.interest_over_time$hits,
                     us$booking.interest_over_time$hits,us$reservation.interest_over_time$hits,
                     us$restaurant.interest_over_time$hits)
colnames(us_l) <- keywords
head(us_l)

us_ts <- as.xts(us_l, order.by =us$flight.interest_over_time$date )

us_week <-  rollapply(us_ts, 7, mean)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
dygraph(us_week["20200101/"], main = "Google Trends: Suchergebnisse in den USA", width = 800)%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>%
  dyOptions(colors = c("black","maroon", "gray", "navy"))%>%
  dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
  dyCSS("legend.css")%>%
dyRangeSelector()%>%
  dyUnzoom()
```
*Quelle: Flossbach von Storch Research Institute, \n Google Trends*

```{r echo=FALSE, results = "hide", message=FALSE, warning=FALSE}
keywords=c("flug","bahn","reservierung","restaurant")
#set the time window
germany <- sapply(keywords, function(x) gtrends(x, geo = "DE", time, onlyInterest=TRUE))
germany_l<- data.frame(germany$flug.interest_over_time$hits,
                     germany$bahn.interest_over_time$hits,germany$reservierung.interest_over_time$hits,germany$restaurant.interest_over_time$hits)
colnames(germany_l) <- keywords
head(germany_l)

germany_ts <- as.xts(germany_l, order.by =germany$flug.interest_over_time$date )

germany_week <-  rollapply(germany_ts, 7, mean)
```

```{r echo=FALSE, message= FALSE, warning=FALSE}
dygraph(germany_week["20200201/"], main = "Google Trends: weitere Ergebnisse in Deutschland", width = 800)%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>%
  dyOptions(colors = c("black","maroon", "gray", "navy"))%>%
dyLegend(labelsSeparateLines = TRUE, show = "always")%>%
  dyCSS("legend.css")%>%
dyRangeSelector()%>%
  dyUnzoom()
```
*Quelle: Flossbach von Storch Research Institute, \n Google Trends*



	
	
	
	
	
	
	
	


